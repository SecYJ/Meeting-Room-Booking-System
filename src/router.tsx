import { createRouter } from "@tanstack/react-router";
import { QueryClient } from "@tanstack/react-query";
import { routerWithQueryClient } from "@tanstack/react-router-with-query";
import { routeTree } from "./routeTree.gen";

export const getRouter = () => {
    const queryClient = new QueryClient({
        defaultOptions: {
            queries: {
                gcTime: 5000,
            },
        },
    });

    const router = routerWithQueryClient(
        createRouter({
            routeTree,
            defaultPreload: "intent",
            context: { queryClient },
            scrollRestoration: true,
            defaultPreloadStaleTime: 0, // Let React Query handle all caching
            defaultErrorComponent: (err) => <p>{err.error.stack}</p>,
            defaultNotFoundComponent: () => <p>not found</p>,
        }),
        queryClient,
    );

    return router;
};
